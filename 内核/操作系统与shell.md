[TOC]

# 操作系统与shell

## 一、什么是操作系统

> 操作系统，即Operating System,OS，是内核(kernel)、shell以及一系列应用软件、驱动的集合。

OS的作用在于：

- 管理好硬件和软件，包括进程管理、文件管理、内存管理和设备管理;
- 为用户提供一个稳定的运行环境。

**注：所谓管理，本质上就是描述(struct)并组织(数据结构+算法)**

### 1、什么是kernel

内核(kernel)，是操作系统的==内部核心管理程序==，它在内管理着计算机的各种资源，向外又提供了一系列的对计算机资源进行管理的接口，即系统调用接口(System Call)。内核以外的程序统称为“外部管理程序”。

### 2、什么是shell

尽管已经有了功能强大的操作系统，但是直接控制OS以管理软硬件，**学习成本较高**，且一旦出现错误操作很可能会直接**威胁内核**，因此开发者们引入了shell：

> shell，即外壳，是连接用户和操作系统的**软件层**，包裹在操作系统的外层。

shell的作用包括两方面：

- 与操作系统进行交互，接收用户的命令并将其传达给操作系统，最后进行反馈。从这一层面，shell可以看作一个==“命令行解释器”==，linux中的默认命令行解释器名为=="bash"==。
- shell作为用户和操作系统的中间层，起到了“保护内核”的作用。

## 二、System Call

为了保护内核，操作系统**不相信任何用户**，不允许用户越过自己来直接操作它管理的软硬件资源。

因此，操作系统向外暴露了一系列的系统调用接口(System Call)供shell和语言的库函数使用(不同语言的部分函数底层都会调用系统接口)。

![image-20220801213545659](https://mypicture-1307604235.cos.ap-nanjing.myqcloud.com/mytyporaimage-20220801213545659.png) 

### 补充：用户态与内核态

用户态与内核态本质是==CPU的两种状态==。

进程一般运行在CPU的==**用户态**==。在用户状态下，CPU只能执行**非特权指令**，这些指令不能直接访问系统资源。

但是当进程代码试图通过系统调用接口获取OS提供的服务时，OS要先将CPU切换至==**内核态**==，在这种状态下，CPU能够执行**特权指令**，从而访问到更多OS管理的资源。

注意：用户态到内核态的切换一般发生在**系统调用、异常与硬件中断**时，这种切换是耗时的。

耗时的原因在于：CPU**需要保存用户态的上下文**，然后再切换至内核态运行。



